<script type="text/javascript">
    tjq(document).ready(function () {
        // Prepare auto-complete with taxons under the taxonomies with specific names.
        var goingTo = tjq('[type=text]<%=selector%>');
        goingTo.autocomplete({
            source: function (request, response) {
                // Get values from taxons rest service.
                tjq.ajax({
                    url: '/api/taxons',
                    type: 'GET',
                    data: {per_page: 10, q: {taxonomy_name_in: <%=raw taxonomies.to_json%>, name_cont: request.term}},
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        response(data.taxons.map(function (t) {
                            return { label: t.name, id: t.id }
                        }));
                    }
                });
            },

            // Fired when value is selected and set item id in hidden field.
            select:function( event, ui ) {
                tjq('[type=hidden]<%=selector%>').val(ui.item.id);
            },

            // Fired when open item list.
            open: function () {
                goingTo.autocomplete("widget")
                        .width(goingTo.width() - 2)
                        .css('padding-left', goingTo.css('padding-left'))
                        .css('padding-right', goingTo.css('padding-right'));
            }
        });
    });
</script>
